<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>KimyaKafasÄ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0b1220;
  color:#e5e7eb;
}
.screen{
  display:none;
  padding:20px;
  max-width:420px;
  margin:auto;
}
.active{display:block;}
h1{text-align:center;color:#38bdf8;}
h2{color:#38bdf8;font-size:18px;margin-top:20px;}
button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
  transition:transform 0.1s;
}
button:active{transform:scale(0.98);}
.green{background:#22c55e;}
.orange{background:#f59e0b;color:#000;}
.red{background:#ef4444;}
.blue{background:#3b82f6;}
.purple{background:#a855f7;}
.gray{background:#334155;}
input, textarea, select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  box-sizing:border-box;
  background:#1e293b;
  color:#e5e7eb;
}
textarea{
  min-height:100px;
  resize:vertical;
}
.info{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  color:#94a3b8;
  margin-bottom:10px;
}
.timer{
  font-size:20px;
  color:#f59e0b;
  text-align:center;
  margin:10px 0;
  font-weight:bold;
}
.stats{
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin:10px 0;
}
.stat-row{
  display:flex;
  justify-content:space-between;
  margin:5px 0;
  font-size:14px;
}
.leaderboard{
  background:#1e293b;
  padding:10px;
  border-radius:10px;
  margin:10px 0;
}
.leader-item{
  display:flex;
  justify-content:space-between;
  padding:8px;
  border-bottom:1px solid #334155;
}
.footer{
  margin-top:20px;
  text-align:center;
  font-size:13px;
  color:#94a3b8;
}
.footer img{
  width:70px;
  border-radius:50%;
  display:block;
  margin:0 auto 5px;
}
.difficulty-badge{
  display:inline-block;
  padding:4px 12px;
  border-radius:20px;
  font-size:12px;
  margin:5px;
}
.easy{background:#22c55e;}
.medium{background:#f59e0b;color:#000;}
.hard{background:#ef4444;}
.streak{
  text-align:center;
  font-size:24px;
  margin:10px 0;
  color:#fbbf24;
}
.difficulty-select{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:10px;
  margin:15px 0;
}
.difficulty-select button{
  margin:0;
}
.question-item{
  background:#1e293b;
  padding:12px;
  border-radius:8px;
  margin:10px 0;
  border-left:3px solid #38bdf8;
}
.question-item:hover{
  background:#334155;
}
.question-actions{
  display:flex;
  gap:10px;
  margin-top:8px;
}
.question-actions button{
  margin:0;
  padding:6px 12px;
  font-size:14px;
}
.admin-btn{
  position:fixed;
  top:10px;
  right:10px;
  padding:8px 16px;
  background:#a855f7;
  border:none;
  border-radius:8px;
  color:white;
  cursor:pointer;
  font-size:14px;
  z-index:1000;
}
.form-group{
  margin:15px 0;
}
.form-group label{
  display:block;
  color:#94a3b8;
  margin-bottom:5px;
  font-size:14px;
}
.radio-group{
  display:flex;
  gap:15px;
  margin-top:8px;
}
.radio-group label{
  display:flex;
  align-items:center;
  gap:5px;
  cursor:pointer;
}
.radio-group input[type="radio"]{
  width:auto;
  margin:0;
}
.success-msg{
  background:#22c55e;
  color:white;
  padding:12px;
  border-radius:8px;
  margin:10px 0;
  text-align:center;
}
.error-msg{
  background:#ef4444;
  color:white;
  padding:12px;
  border-radius:8px;
  margin:10px 0;
  text-align:center;
}
.loading{
  text-align:center;
  padding:20px;
  color:#94a3b8;
}
</style>
</head>
<body>

<button class="admin-btn" onclick="showAdminLogin()">ğŸ‘¨â€ğŸ’¼ Admin</button>

<!-- GÄ°RÄ°Å -->
<div class="screen active" id="home">
  <h1>ğŸ§  KimyaKafalÄ±</h1>
  <div class="stats">
    <div class="stat-row">
      <span>Toplam Skor:</span>
      <span id="totalScore">0</span>
    </div>
    <div class="stat-row">
      <span>En YÃ¼ksek Seri:</span>
      <span id="highStreak">0</span>
    </div>
  </div>

  <h2>Zorluk SeÃ§</h2>
  <div class="difficulty-select">
    <button class="green" onclick="startWithDifficulty('kolay')">ğŸ˜Š<br>Kolay<br>30sn</button>
    <button class="orange" onclick="startWithDifficulty('orta')">ğŸ˜<br>Orta<br>20sn</button>
    <button class="red" onclick="startWithDifficulty('zor')">ğŸ˜¤<br>Zor<br>15sn</button>
  </div>
  
  <button class="blue" onclick="go('leaderboard')">ğŸ† Lider Tablosu</button>
  <button class="gray" onclick="go('stats')">ğŸ“Š Ä°statistikler</button>
  <button class="gray" onclick="go('info')">â„¹ Bilgi</button>
  <button class="gray" onclick="go('settings')">âš™ Ayarlar</button>

  <div class="footer">
    YÄ°NREAT
  </div>
</div>

<!-- OYUN -->
<div class="screen" id="game">
  <div class="info">
    <span id="mode">KarÄ±ÅŸÄ±k</span>
    <span id="money">ğŸ’° 0</span>
  </div>
  
  <div class="info">
    <span>Zorluk: <span id="difficultyDisplay" class="difficulty-badge easy">Kolay</span></span>
    <span>Soru: <span id="questionCount">1</span>/10</span>
  </div>

  <div class="timer" id="timer">â± 30</div>
  <div class="streak" id="streak">ğŸ”¥ 0</div>

  <h1 id="question" style="white-space:pre-wrap;"></h1>
  <input id="answer" placeholder="CevabÄ± yaz" autocomplete="off" aria-label="Cevap" onkeypress="if(event.key==='Enter')check()">
  <button class="green" onclick="check()">Kontrol Et</button>
  <button class="orange" onclick="hint()">ğŸ’¡ Ä°pucu (-5)</button>
  <div id="result" style="text-align:center;margin-top:10px;font-size:18px;"></div>

  <button class="gray" onclick="endGame()">â¬… Oyunu Bitir</button>

  <div class="footer">
    @kimyakafali
  </div>
</div>

<!-- LÄ°DER TABLOSU -->
<div class="screen" id="leaderboard">
  <h1>ğŸ† Lider Tablosu</h1>
  <div class="leaderboard" id="leaderList"></div>
  <button class="gray" onclick="go('home')">â¬… Geri</button>
</div>

<!-- Ä°STATÄ°STÄ°KLER -->
<div class="screen" id="stats">
  <h1>ğŸ“Š Ä°statistikler</h1>
  <div class="stats">
    <h2>Genel Ä°statistikler</h2>
    <div id="categoryStats"></div>
  </div>
  <button class="red" onclick="resetStats()">ğŸ—‘ Ä°statistikleri SÄ±fÄ±rla</button>
  <button class="gray" onclick="go('home')">â¬… Geri</button>
</div>

<!-- BÄ°LGÄ° -->
<div class="screen" id="info">
  <h1>â„¹ Bilgi</h1>
  
  <div style="background:#1e293b;padding:15px;border-radius:10px;margin:10px 0;">
    <h2>ğŸ”— Hidrokarbon GruplarÄ±</h2>
    <p><b>Alkan:</b> Tek baÄŸ, Câ‚™Hâ‚‚â‚™â‚Šâ‚‚</p>
    <p><b>Alken:</b> Ã‡ift baÄŸ (C=C), Câ‚™Hâ‚‚â‚™</p>
    <p><b>Alkin:</b> ÃœÃ§lÃ¼ baÄŸ (Câ‰¡C), Câ‚™Hâ‚‚â‚™â‚‹â‚‚</p>
    <p><b>Sikloalkan:</b> HalkalÄ±, tek baÄŸ, Câ‚™Hâ‚‚â‚™</p>
    <p><b>Sikloalken:</b> HalkalÄ±, Ã§ift baÄŸ, Câ‚™Hâ‚‚â‚™â‚‹â‚‚</p>
    <p><b>Sikloalkin:</b> HalkalÄ±, Ã¼Ã§lÃ¼ baÄŸ, Câ‚™Hâ‚‚â‚™â‚‹â‚„</p>
  </div>

  <div style="background:#1e293b;padding:15px;border-radius:10px;margin:10px 0;">
    <h2>ğŸ”¬ BaÄŸ Bilgileri</h2>
    <p><b>Sigma (Ïƒ) baÄŸ:</b> Her baÄŸda 1 tane vardÄ±r.</p>
    <p><b>Pi (Ï€) baÄŸ:</b> Ã‡ift baÄŸda 1, Ã¼Ã§lÃ¼ baÄŸda 2 tane vardÄ±r.</p>
    <p><b>Toplam baÄŸ:</b> Sigma + Pi baÄŸlarÄ±nÄ±n toplamÄ±</p>
  </div>

  <div style="background:#1e293b;padding:15px;border-radius:10px;margin:10px 0;">
    <h2>âš—ï¸ Tepkimeler</h2>
    <p><b>Yanma Tepkimesi:</b> Hidrokarbon + Oâ‚‚ â†’ COâ‚‚ + Hâ‚‚O</p>
    <p><b>KatÄ±lma Tepkimesi:</b> Ã‡ift veya Ã¼Ã§lÃ¼ baÄŸa atom/grup eklenir</p>
  </div>

  <button class="gray" onclick="go('home')">â¬… Geri</button>
</div>

<!-- AYARLAR -->
<div class="screen" id="settings">
  <h1>âš™ Ayarlar</h1>
  
  <h2>Oyun Modu</h2>
  <button class="blue" onclick="toggleTimer()">â± SÃ¼re: <span id="timerStatus">AÃ§Ä±k</span></button>
  
  <h2>Soru Havuzu</h2>
  <p style="text-align:center;color:#94a3b8;">Toplam <span id="totalQuestions">1000+</span> soru</p>
  <p style="text-align:center;color:#94a3b8;">Alkan, Alken, Alkin</p>
  <p style="text-align:center;color:#94a3b8;">Sikloalkan, Sikloalken, Sikloalkin</p>
  <p style="text-align:center;color:#94a3b8;">DallanmÄ±ÅŸ yapÄ±lar ve formÃ¼l sorularÄ±</p>

  <button class="gray" style="margin-top:20px;" onclick="go('home')">â¬… Geri</button>
</div>

<!-- ADMÄ°N GÄ°RÄ°Å -->
<div class="screen" id="adminLogin">
  <h1>ğŸ” Admin GiriÅŸi</h1>
  <div class="stats">
    <input type="password" id="adminPassword" placeholder="Admin Åifresi" onkeypress="if(event.key==='Enter')adminLogin()">
    <button class="purple" onclick="adminLogin()">GiriÅŸ Yap</button>
    <div id="loginError" style="margin-top:10px;"></div>
  </div>
  <button class="gray" onclick="go('home')">â¬… Geri</button>
</div>

<!-- ADMÄ°N PANEL -->
<div class="screen" id="adminPanel">
  <h1>ğŸ‘¨â€ğŸ’¼ Admin Paneli</h1>
  
  <div class="stats">
    <div class="stat-row">
      <span>Toplam Soru:</span>
      <span id="adminTotalQuestions">0</span>
    </div>
    <div class="stat-row">
      <span>URL'li Sorular:</span>
      <span id="adminUrlQuestions">0</span>
    </div>
    <div class="stat-row">
      <span>Normal Sorular:</span>
      <span id="adminNormalQuestions">0</span>
    </div>
  </div>

  <button class="green" onclick="go('addQuestion')">â• Yeni Soru Ekle</button>
  <button class="blue" onclick="go('manageQuestions')">ğŸ“ SorularÄ± YÃ¶net</button>
  <button class="red" onclick="adminLogout()">ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</button>
</div>

<!-- SORU EKLEME -->
<div class="screen" id="addQuestion">
  <h1>â• Yeni Soru Ekle</h1>
  
  <div class="form-group">
    <label>Soru Metni:</label>
    <textarea id="newQuestionText" placeholder="Soruyu buraya yazÄ±n..."></textarea>
  </div>

  <div class="form-group">
    <label>DoÄŸru Cevap:</label>
    <input type="text" id="newQuestionAnswer" placeholder="DoÄŸru cevap">
  </div>

  <div class="form-group">
    <label>Zorluk Seviyesi:</label>
    <div class="radio-group">
      <label>
        <input type="radio" name="difficulty" value="kolay" checked>
        <span>Kolay</span>
      </label>
      <label>
        <input type="radio" name="difficulty" value="orta">
        <span>Orta</span>
      </label>
      <label>
        <input type="radio" name="difficulty" value="zor">
        <span>Zor</span>
      </label>
    </div>
  </div>

  <div class="form-group">
    <label>Soru Tipi:</label>
    <div class="radio-group">
      <label>
        <input type="radio" name="questionType" value="normal" checked onchange="toggleUrlField()">
        <span>Normal</span>
      </label>
      <label>
        <input type="radio" name="questionType" value="url" onchange="toggleUrlField()">
        <span>URL'li</span>
      </label>
    </div>
  </div>

  <div class="form-group" id="urlField" style="display:none;">
    <label>Resim URL:</label>
    <input type="text" id="newQuestionUrl" placeholder="https://example.com/image.jpg">
  </div>

  <div id="addQuestionMessage"></div>

  <button class="green" onclick="addNewQuestion()">ğŸ’¾ Soruyu Kaydet</button>
  <button class="gray" onclick="go('adminPanel')">â¬… Geri</button>
</div>

<!-- SORU YÃ–NETÄ°MÄ° -->
<div class="screen" id="manageQuestions">
  <h1>ğŸ“ Sorular</h1>
  
  <div class="form-group">
    <label>Filtrele:</label>
    <select id="questionFilter" onchange="filterQuestions()">
      <option value="all">TÃ¼mÃ¼</option>
      <option value="normal">Normal Sorular</option>
      <option value="url">URL'li Sorular</option>
      <option value="kolay">Kolay</option>
      <option value="orta">Orta</option>
      <option value="zor">Zor</option>
    </select>
  </div>

  <div id="questionsList" class="loading">YÃ¼kleniyor...</div>

  <button class="gray" onclick="go('adminPanel')">â¬… Geri</button>
</div>

<!-- SORU DÃœZENLEME -->
<div class="screen" id="editQuestion">
  <h1>âœï¸ Soruyu DÃ¼zenle</h1>
  
  <div class="form-group">
    <label>Soru Metni:</label>
    <textarea id="editQuestionText"></textarea>
  </div>

  <div class="form-group">
    <label>DoÄŸru Cevap:</label>
    <input type="text" id="editQuestionAnswer">
  </div>

  <div class="form-group">
    <label>Zorluk Seviyesi:</label>
    <div class="radio-group">
      <label>
        <input type="radio" name="editDifficulty" value="kolay">
        <span>Kolay</span>
      </label>
      <label>
        <input type="radio" name="editDifficulty" value="orta">
        <span>Orta</span>
      </label>
      <label>
        <input type="radio" name="editDifficulty" value="zor">
        <span>Zor</span>
      </label>
    </div>
  </div>

  <div class="form-group">
    <label>Soru Tipi:</label>
    <div class="radio-group">
      <label>
        <input type="radio" name="editQuestionType" value="normal" onchange="toggleEditUrlField()">
        <span>Normal</span>
      </label>
      <label>
        <input type="radio" name="editQuestionType" value="url" onchange="toggleEditUrlField()">
        <span>URL'li</span>
      </label>
    </div>
  </div>

  <div class="form-group" id="editUrlField" style="display:none;">
    <label>Resim URL:</label>
    <input type="text" id="editQuestionUrl">
  </div>

  <div id="editQuestionMessage"></div>

  <button class="blue" onclick="updateQuestion()">ğŸ’¾ GÃ¼ncelle</button>
  <button class="gray" onclick="go('manageQuestions')">â¬… Ä°ptal</button>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, get, push, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

// Firebase yapÄ±landÄ±rmasÄ± - BURAYA KENDÄ° FIREBASE BÄ°LGÄ°LERÄ°NÄ°ZÄ° YAZIN
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

// Firebase baÅŸlat
const app = initializeApp(firebaseConfig);
const database = getDatabase(app);

// Global deÄŸiÅŸkenler
window.firebaseDB = database;
window.firebaseRef = ref;
window.firebaseSet = set;
window.firebaseGet = get;
window.firebasePush = push;
window.firebaseRemove = remove;
window.firebaseOnValue = onValue;

// SorularÄ± yÃ¼kle
loadQuestionsFromFirebase();

</script>

<script>
// Admin ÅŸifresi - GÃ¼venlik iÃ§in deÄŸiÅŸtirin
const ADMIN_PASSWORD = "kimya2024";

// Veri yapÄ±larÄ±
const alkan = ["","metan","etan","propan","bÃ¼tan","pentan","heksan","heptan","oktan","nonan","dekan"];
const alken = ["","eten","propen","bÃ¼ten","penten","hekzen","hepten","okten","nonen","deken"];
const alkin = ["","etin","propin","bÃ¼tin","pentin","heksin","heptin","oktin","nonin","dekin"];
const sikloalkan = ["","","","siklopropan","siklobÃ¼tan","siklopentan","sikloheksan","sikloheptan","siklooktan","siklononan","siklodekan"];
const sikloalken = ["","","","siklopropen","siklobÃ¼ten","siklopenten","siklohekzen","siklohepten","siklookten","siklononen","siklodeken"];
const sikloalkin = ["","","","","siklobÃ¼tin","siklopentin","sikloheksin","sikloheptin","siklooktin","siklononin","siklodekin"];

// Oyun durumu
let gameState = {
  money: 0,
  totalScore: parseInt(localStorage.getItem('totalScore') || '0'),
  highStreak: parseInt(localStorage.getItem('highStreak') || '0'),
  currentStreak: 0,
  questionNumber: 1,
  maxQuestions: 10,
  difficulty: 'kolay',
  timerEnabled: true,
  timeLeft: 30,
  timerInterval: null,
  stats: JSON.parse(localStorage.getItem('stats') || '{"dogru":0,"yanlis":0}'),
  isAdmin: false
};

let current;
let usedQuestions = [];
let questionPool = [];
let firebaseQuestions = [];
let currentEditingQuestionId = null;

// Firebase'den sorularÄ± yÃ¼kle
async function loadQuestionsFromFirebase() {
  try {
    const questionsRef = window.firebaseRef(window.firebaseDB, 'questions');
    const snapshot = await window.firebaseGet(questionsRef);
    
    if (snapshot.exists()) {
      const data = snapshot.val();
      firebaseQuestions = Object.keys(data).map(key => ({
        id: key,
        ...data[key]
      }));
      
      // VarsayÄ±lan sorularla birleÅŸtir
      questionPool = [...generateQuestionPool(), ...firebaseQuestions];
      
      // Toplam soru sayÄ±sÄ±nÄ± gÃ¼ncelle
      document.getElementById('totalQuestions').innerText = questionPool.length;
      
      console.log('Firebase sorular yÃ¼klendi:', firebaseQuestions.length);
    } else {
      questionPool = generateQuestionPool();
      console.log('Firebase\'de soru yok, varsayÄ±lan sorular kullanÄ±lÄ±yor');
    }
  } catch (error) {
    console.error('Firebase sorular yÃ¼klenirken hata:', error);
    questionPool = generateQuestionPool();
  }
}

// VarsayÄ±lan soru havuzu
function generateQuestionPool(){
  let pool = [];
  
  // ALKAN SORULARI
  for(let c = 1; c <= 10; c++){
    pool.push({q:`C${c}H${2*c+2} bileÅŸiÄŸinin adÄ± nedir?`, a:alkan[c], diff:'kolay', type:'normal'});
    pool.push({q:`${alkan[c]} kaÃ§ karbonludur?`, a:c.toString(), diff:'kolay', type:'normal'});
    pool.push({q:`${alkan[c]} kaÃ§ hidrojenlidir?`, a:(2*c+2).toString(), diff:'kolay', type:'normal'});
    pool.push({q:`C${c}H${2*c+2} kaÃ§ sigma baÄŸÄ± iÃ§erir?`, a:(3*c+1).toString(), diff:'orta', type:'normal'});
    pool.push({q:`${alkan[c]} kaÃ§ pi baÄŸÄ± iÃ§erir?`, a:"0", diff:'kolay', type:'normal'});
  }
  
  // ALKEN SORULARI
  for(let c = 2; c <= 10; c++){
    pool.push({q:`C${c}H${2*c} bileÅŸiÄŸinin adÄ± nedir?`, a:alken[c-1], diff:'kolay', type:'normal'});
    pool.push({q:`${alken[c-1]} kaÃ§ karbonludur?`, a:c.toString(), diff:'kolay', type:'normal'});
    pool.push({q:`${alken[c-1]} kaÃ§ pi baÄŸÄ± iÃ§erir?`, a:"1", diff:'kolay', type:'normal'});
  }
  
  // ALKÄ°N SORULARI
  for(let c = 2; c <= 10; c++){
    pool.push({q:`C${c}H${2*c-2} bileÅŸiÄŸinin adÄ± nedir?`, a:alkin[c-1], diff:'kolay', type:'normal'});
    pool.push({q:`${alkin[c-1]} kaÃ§ pi baÄŸÄ± iÃ§erir?`, a:"2", diff:'orta', type:'normal'});
  }
  
  return pool;
}

// Admin giriÅŸ kontrolÃ¼
function showAdminLogin() {
  if (gameState.isAdmin) {
    go('adminPanel');
  } else {
    go('adminLogin');
  }
}

function adminLogin() {
  const password = document.getElementById('adminPassword').value;
  const errorDiv = document.getElementById('loginError');
  
  if (password === ADMIN_PASSWORD) {
    gameState.isAdmin = true;
    sessionStorage.setItem('isAdmin', 'true');
    go('adminPanel');
    updateAdminStats();
    document.getElementById('adminPassword').value = '';
    errorDiv.innerHTML = '';
  } else {
    errorDiv.innerHTML = '<div class="error-msg">âŒ YanlÄ±ÅŸ ÅŸifre!</div>';
  }
}

function adminLogout() {
  gameState.isAdmin = false;
  sessionStorage.removeItem('isAdmin');
  go('home');
}

// Admin panel istatistikleri
function updateAdminStats() {
  const total = questionPool.length;
  const urlQuestions = questionPool.filter(q => q.type === 'url' || q.url).length;
  const normalQuestions = total - urlQuestions;
  
  document.getElementById('adminTotalQuestions').innerText = total;
  document.getElementById('adminUrlQuestions').innerText = urlQuestions;
  document.getElementById('adminNormalQuestions').innerText = normalQuestions;
}

// URL alanÄ±nÄ± gÃ¶ster/gizle
function toggleUrlField() {
  const type = document.querySelector('input[name="questionType"]:checked').value;
  document.getElementById('urlField').style.display = type === 'url' ? 'block' : 'none';
}

function toggleEditUrlField() {
  const type = document.querySelector('input[name="editQuestionType"]:checked').value;
  document.getElementById('editUrlField').style.display = type === 'url' ? 'block' : 'none';
}

// Yeni soru ekleme
async function addNewQuestion() {
  const text = document.getElementById('newQuestionText').value.trim();
  const answer = document.getElementById('newQuestionAnswer').value.trim();
  const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
  const type = document.querySelector('input[name="questionType"]:checked').value;
  const url = type === 'url' ? document.getElementById('newQuestionUrl').value.trim() : '';
  const messageDiv = document.getElementById('addQuestionMessage');
  
  if (!text || !answer) {
    messageDiv.innerHTML = '<div class="error-msg">âŒ Soru ve cevap alanlarÄ± zorunludur!</div>';
    return;
  }
  
  if (type === 'url' && !url) {
    messageDiv.innerHTML = '<div class="error-msg">âŒ URL'li soru iÃ§in resim URL'si gereklidir!</div>';
    return;
  }
  
  try {
    const questionsRef = window.firebaseRef(window.firebaseDB, 'questions');
    const newQuestionRef = window.firebasePush(questionsRef);
    
    const questionData = {
      q: text,
      a: answer,
      diff: difficulty,
      type: type,
      createdAt: new Date().toISOString()
    };
    
    if (url) {
      questionData.url = url;
    }
    
    await window.firebaseSet(newQuestionRef, questionData);
    
    messageDiv.innerHTML = '<div class="success-msg">âœ… Soru baÅŸarÄ±yla eklendi!</div>';
    
    // Formu temizle
    document.getElementById('newQuestionText').value = '';
    document.getElementById('newQuestionAnswer').value = '';
    document.getElementById('newQuestionUrl').value = '';
    document.querySelector('input[name="difficulty"][value="kolay"]').checked = true;
    document.querySelector('input[name="questionType"][value="normal"]').checked = true;
    toggleUrlField();
    
    // SorularÄ± yeniden yÃ¼kle
    await loadQuestionsFromFirebase();
    updateAdminStats();
    
    setTimeout(() => {
      messageDiv.innerHTML = '';
    }, 3000);
    
  } catch (error) {
    console.error('Soru eklenirken hata:', error);
    messageDiv.innerHTML = '<div class="error-msg">âŒ Soru eklenirken bir hata oluÅŸtu!</div>';
  }
}

// SorularÄ± filtreleme
function filterQuestions() {
  const filter = document.getElementById('questionFilter').value;
  displayQuestions(filter);
}

// SorularÄ± listeleme
async function displayQuestions(filter = 'all') {
  const listDiv = document.getElementById('questionsList');
  listDiv.innerHTML = '<div class="loading">YÃ¼kleniyor...</div>';
  
  try {
    const questionsRef = window.firebaseRef(window.firebaseDB, 'questions');
    const snapshot = await window.firebaseGet(questionsRef);
    
    if (!snapshot.exists()) {
      listDiv.innerHTML = '<p style="text-align:center;color:#94a3b8;">HenÃ¼z soru eklenmemiÅŸ</p>';
      return;
    }
    
    const data = snapshot.val();
    let questions = Object.keys(data).map(key => ({
      id: key,
      ...data[key]
    }));
    
    // Filtreleme
    if (filter !== 'all') {
      if (filter === 'normal' || filter === 'url') {
        questions = questions.filter(q => q.type === filter);
      } else {
        questions = questions.filter(q => q.diff === filter);
      }
    }
    
    if (questions.length === 0) {
      listDiv.innerHTML = '<p style="text-align:center;color:#94a3b8;">Bu filtre iÃ§in soru bulunamadÄ±</p>';
      return;
    }
    
    let html = '';
    questions.forEach(q => {
      const diffBadge = q.diff === 'kolay' ? 'easy' : q.diff === 'orta' ? 'medium' : 'hard';
      const typeIcon = q.type === 'url' ? 'ğŸ–¼ï¸' : 'ğŸ“';
      
      html += `
        <div class="question-item">
          <div style="margin-bottom:8px;">
            <span class="difficulty-badge ${diffBadge}">${q.diff}</span>
            <span style="margin-left:5px;">${typeIcon}</span>
          </div>
          <div style="color:#e5e7eb;margin-bottom:5px;"><b>Soru:</b> ${q.q}</div>
          <div style="color:#94a3b8;font-size:14px;"><b>Cevap:</b> ${q.a}</div>
          ${q.url ? `<div style="color:#94a3b8;font-size:12px;margin-top:5px;">ğŸ”— ${q.url}</div>` : ''}
          <div class="question-actions">
            <button class="blue" onclick="editQuestionForm('${q.id}')">âœï¸ DÃ¼zenle</button>
            <button class="red" onclick="deleteQuestion('${q.id}')">ğŸ—‘ï¸ Sil</button>
          </div>
        </div>
      `;
    });
    
    listDiv.innerHTML = html;
    
  } catch (error) {
    console.error('Sorular yÃ¼klenirken hata:', error);
    listDiv.innerHTML = '<div class="error-msg">âŒ Sorular yÃ¼klenirken bir hata oluÅŸtu!</div>';
  }
}

// Soru dÃ¼zenleme formu
async function editQuestionForm(questionId) {
  try {
    const questionRef = window.firebaseRef(window.firebaseDB, `questions/${questionId}`);
    const snapshot = await window.firebaseGet(questionRef);
    
    if (!snapshot.exists()) {
      alert('Soru bulunamadÄ±!');
      return;
    }
    
    const question = snapshot.val();
    currentEditingQuestionId = questionId;
    
    document.getElementById('editQuestionText').value = question.q;
    document.getElementById('editQuestionAnswer').value = question.a;
    document.querySelector(`input[name="editDifficulty"][value="${question.diff}"]`).checked = true;
    document.querySelector(`input[name="editQuestionType"][value="${question.type || 'normal'}"]`).checked = true;
    
    if (question.url) {
      document.getElementById('editQuestionUrl').value = question.url;
    }
    
    toggleEditUrlField();
    go('editQuestion');
    
  } catch (error) {
    console.error('Soru yÃ¼klenirken hata:', error);
    alert('Soru yÃ¼klenirken bir hata oluÅŸtu!');
  }
}

// Soru gÃ¼ncelleme
async function updateQuestion() {
  if (!currentEditingQuestionId) return;
  
  const text = document.getElementById('editQuestionText').value.trim();
  const answer = document.getElementById('editQuestionAnswer').value.trim();
  const difficulty = document.querySelector('input[name="editDifficulty"]:checked').value;
  const type = document.querySelector('input[name="editQuestionType"]:checked').value;
  const url = type === 'url' ? document.getElementById('editQuestionUrl').value.trim() : '';
  const messageDiv = document.getElementById('editQuestionMessage');
  
  if (!text || !answer) {
    messageDiv.innerHTML = '<div class="error-msg">âŒ Soru ve cevap alanlarÄ± zorunludur!</div>';
    return;
  }
  
  if (type === 'url' && !url) {
    messageDiv.innerHTML = '<div class="error-msg">âŒ URL'li soru iÃ§in resim URL'si gereklidir!</div>';
    return;
  }
  
  try {
    const questionRef = window.firebaseRef(window.firebaseDB, `questions/${currentEditingQuestionId}`);
    
    const questionData = {
      q: text,
      a: answer,
      diff: difficulty,
      type: type,
      updatedAt: new Date().toISOString()
    };
    
    if (url) {
      questionData.url = url;
    }
    
    await window.firebaseSet(questionRef, questionData);
    
    messageDiv.innerHTML = '<div class="success-msg">âœ… Soru baÅŸarÄ±yla gÃ¼ncellendi!</div>';
    
    await loadQuestionsFromFirebase();
    
    setTimeout(() => {
      go('manageQuestions');
      displayQuestions();
    }, 1500);
    
  } catch (error) {
    console.error('Soru gÃ¼ncellenirken hata:', error);
    messageDiv.innerHTML = '<div class="error-msg">âŒ Soru gÃ¼ncellenirken bir hata oluÅŸtu!</div>';
  }
}

// Soru silme
async function deleteQuestion(questionId) {
  if (!confirm('Bu soruyu silmek istediÄŸinizden emin misiniz?')) {
    return;
  }
  
  try {
    const questionRef = window.firebaseRef(window.firebaseDB, `questions/${questionId}`);
    await window.firebaseRemove(questionRef);
    
    await loadQuestionsFromFirebase();
    updateAdminStats();
    displayQuestions(document.getElementById('questionFilter').value);
    
    alert('âœ… Soru baÅŸarÄ±yla silindi!');
    
  } catch (error) {
    console.error('Soru silinirken hata:', error);
    alert('âŒ Soru silinirken bir hata oluÅŸtu!');
  }
}

// Ekran geÃ§iÅŸi
function go(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  
  if(id==="home") updateHomeScreen();
  if(id==="leaderboard") updateLeaderboard();
  if(id==="stats") updateStats();
  if(id==="adminPanel") updateAdminStats();
  if(id==="manageQuestions") displayQuestions();
}

// Zorlukla baÅŸlat
function startWithDifficulty(diff){
  gameState.difficulty = diff;
  go('game');
  startGame();
}

// Ana ekran gÃ¼ncelle
function updateHomeScreen(){
  document.getElementById('totalScore').innerText = gameState.totalScore;
  document.getElementById('highStreak').innerText = gameState.highStreak;
}

// Oyunu baÅŸlat
function startGame(){
  gameState.money = 0;
  gameState.currentStreak = 0;
  gameState.questionNumber = 1;
  usedQuestions = [];
  updateDisplay();
  newQuestion();
  if(gameState.timerEnabled) startTimer();
}

// Oyunu bitir
function endGame(){
  stopTimer();
  saveScore();
  go('home');
}

// Skor kaydet
function saveScore(){
  gameState.totalScore += gameState.money;
  if(gameState.currentStreak > gameState.highStreak){
    gameState.highStreak = gameState.currentStreak;
    localStorage.setItem('highStreak', gameState.highStreak);
  }
  localStorage.setItem('totalScore', gameState.totalScore);
  
  let leaders = JSON.parse(localStorage.getItem('leaderboard') || '[]');
  leaders.push({
    score: gameState.money,
    streak: gameState.currentStreak,
    difficulty: gameState.difficulty,
    date: new Date().toLocaleDateString('tr-TR')
  });
  leaders.sort((a,b) => b.score - a.score);
  leaders = leaders.slice(0, 10);
  localStorage.setItem('leaderboard', JSON.stringify(leaders));
}

// Lider tablosunu gÃ¼ncelle
function updateLeaderboard(){
  let leaders = JSON.parse(localStorage.getItem('leaderboard') || '[]');
  let html = '';
  if(leaders.length === 0){
    html = '<p style="text-align:center;color:#94a3b8;">HenÃ¼z kayÄ±t yok</p>';
  } else {
    leaders.forEach((l, i) => {
      html += `<div class="leader-item">
        <span>${i+1}. ${l.difficulty} - ${l.date}</span>
        <span>ğŸ’°${l.score} ğŸ”¥${l.streak}</span>
      </div>`;
    });
  }
  document.getElementById('leaderList').innerHTML = html;
}

// Ä°statistikleri gÃ¼ncelle
function updateStats(){
  let s = gameState.stats;
  let total = s.dogru + s.yanlis;
  let oran = total > 0 ? Math.round((s.dogru / total) * 100) : 0;
  let html = `
    <div class="stat-row"><span>Toplam Soru:</span><span>${total}</span></div>
    <div class="stat-row"><span>DoÄŸru:</span><span style="color:#22c55e">âœ… ${s.dogru}</span></div>
    <div class="stat-row"><span>YanlÄ±ÅŸ:</span><span style="color:#ef4444">âŒ ${s.yanlis}</span></div>
    <div class="stat-row"><span>BaÅŸarÄ± OranÄ±:</span><span style="color:#38bdf8"><b>%${oran}</b></span></div>
  `;
  document.getElementById('categoryStats').innerHTML = html;
}

// Ä°statistikleri sÄ±fÄ±rla
function resetStats(){
  if(confirm('TÃ¼m istatistikler silinecek. Emin misiniz?')){
    localStorage.clear();
    gameState.totalScore = 0;
    gameState.highStreak = 0;
    gameState.stats = {dogru:0, yanlis:0};
    updateStats();
    updateHomeScreen();
    alert('Ä°statistikler sÄ±fÄ±rlandÄ±!');
  }
}

// ZamanlayÄ±cÄ±
function startTimer(){
  gameState.timeLeft = gameState.difficulty === 'kolay' ? 30 : gameState.difficulty === 'orta' ? 20 : 15;
  updateTimer();
  gameState.timerInterval = setInterval(()=>{
    gameState.timeLeft--;
    updateTimer();
    if(gameState.timeLeft <= 0){
      stopTimer();
      document.getElementById("result").innerHTML = "â° SÃ¼re Doldu!<br>âœ… DoÄŸru: " + current.a;
      gameState.currentStreak = 0;
      gameState.stats.yanlis++;
      localStorage.setItem('stats', JSON.stringify(gameState.stats));
      updateDisplay();
      setTimeout(()=>{
        if(gameState.questionNumber >= gameState.maxQuestions){
          endGame();
        } else {
          gameState.questionNumber++;
          newQuestion();
          if(gameState.timerEnabled) startTimer();
        }
      }, 2000);
    }
  }, 1000);
}

function stopTimer(){
  if(gameState.timerInterval){
    clearInterval(gameState.timerInterval);
    gameState.timerInterval = null;
  }
}

function updateTimer(){
  let color = gameState.timeLeft > 10 ? '#22c55e' : gameState.timeLeft > 5 ? '#f59e0b' : '#ef4444';
  document.getElementById("timer").innerHTML = `â± ${gameState.timeLeft}`;
  document.getElementById("timer").style.color = color;
}

function toggleTimer(){
  gameState.timerEnabled = !gameState.timerEnabled;
  document.getElementById("timerStatus").innerText = gameState.timerEnabled ? "AÃ§Ä±k" : "KapalÄ±";
}

// Ekran gÃ¼ncelleme
function updateDisplay(){
  document.getElementById("money").innerText = "ğŸ’° " + gameState.money;
  document.getElementById("streak").innerText = "ğŸ”¥ " + gameState.currentStreak;
  document.getElementById("questionCount").innerText = gameState.questionNumber + "/10";
  document.getElementById("mode").innerText = "KarÄ±ÅŸÄ±k";
  
  let badge = document.getElementById("difficultyDisplay");
  badge.innerText = gameState.difficulty.charAt(0).toUpperCase() + gameState.difficulty.slice(1);
  badge.className = "difficulty-badge " + (gameState.difficulty === 'kolay' ? 'easy' : gameState.difficulty === 'orta' ? 'medium' : 'hard');
}

// Rastgele sayÄ±
function rand(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

// Soru Ã¼retimi
function newQuestion(){
  updateDisplay();
  
  // Zorluk seviyesine gÃ¶re filtrele
  let filtered = questionPool.filter(q => {
    if(gameState.difficulty === 'kolay') return q.diff === 'kolay';
    if(gameState.difficulty === 'orta') return q.diff === 'kolay' || q.diff === 'orta';
    return true;
  });
  
  // KullanÄ±lmamÄ±ÅŸ sorularÄ± al
  let available = filtered.filter((q, i) => !usedQuestions.includes(filtered.indexOf(q)));
  
  if(available.length === 0){
    usedQuestions = [];
    available = filtered;
  }
  
  let randomQ = available[rand(0, available.length - 1)];
  let originalIndex = filtered.indexOf(randomQ);
  usedQuestions.push(originalIndex);
  
  current = {q: randomQ.q, a: randomQ.a, url: randomQ.url};
  showQuestion();
}

function showQuestion(){
  let questionHTML = current.q;
  
  // URL'li soru ise resmi gÃ¶ster
  if (current.url) {
    questionHTML = `<img src="${current.url}" style="max-width:100%;border-radius:10px;margin-bottom:15px;" alt="Soru gÃ¶rseli"><br>${current.q}`;
  }
  
  document.getElementById("question").innerHTML = questionHTML;
  document.getElementById("answer").value="";
  document.getElementById("result").innerText="";
  document.getElementById("answer").focus();
}

// KullanÄ±cÄ± cevabÄ±nÄ± normalize et
function norm(x){
  return x.toLowerCase()
    .replace(/ /g,'')
    .replace(/Ã§/g,'c')
    .replace(/Ä±/g,'i')
    .replace(/ÄŸ/g,'g')
    .replace(/Ã¶/g,'o')
    .replace(/ÅŸ/g,'s')
    .replace(/Ã¼/g,'u')
    .replace(/â‚‚/g,'2')
    .replace(/â‚ƒ/g,'3')
    .replace(/â‚„/g,'4')
    .replace(/â‚…/g,'5')
    .replace(/â‚†/g,'6')
    .replace(/â‚‡/g,'7')
    .replace(/â‚ˆ/g,'8')
    .trim();
}

// CevabÄ± kontrol et
function check(){
  let g = norm(document.getElementById("answer").value);
  let cevap = norm(current.a);
  
  stopTimer();
  
  if(g === cevap){
    gameState.money++;
    gameState.currentStreak++;
    document.getElementById("result").innerText="âœ… DoÄŸru!";
    gameState.stats.dogru++;
    localStorage.setItem('stats', JSON.stringify(gameState.stats));
    
    setTimeout(()=>{
      if(gameState.questionNumber >= gameState.maxQuestions){
        endGame();
      } else {
        gameState.questionNumber++;
        newQuestion();
        if(gameState.timerEnabled) startTimer();
      }
    }, 800);
  } else {
    gameState.currentStreak = 0;
    document.getElementById("result").innerHTML = `âŒ YanlÄ±ÅŸ<br>âœ… DoÄŸru: ${current.a}`;
    gameState.stats.yanlis++;
    localStorage.setItem('stats', JSON.stringify(gameState.stats));
    
    setTimeout(()=>{
      if(gameState.questionNumber >= gameState.maxQuestions){
        endGame();
      } else {
        gameState.questionNumber++;
        newQuestion();
        if(gameState.timerEnabled) startTimer();
      }
    }, 2000);
  }
  updateDisplay();
}

// Ä°pucu
function hint(){
  if(gameState.money < 5){
    alert("Yetersiz para! Ä°pucu iÃ§in en az 5 puan gerekli.");
    return;
  }
  gameState.money -= 5;
  document.getElementById("money").innerText = "ğŸ’° " + gameState.money;
  document.getElementById("result").innerText = "ğŸ’¡ Cevap: " + current.a;
}

// Sayfa yÃ¼klendiÄŸinde
window.onload = function(){
  updateHomeScreen();
  
  // Admin oturumu kontrolÃ¼
  if (sessionStorage.getItem('isAdmin') === 'true') {
    gameState.isAdmin = true;
  }
};
</script>

</body>
</html>
